<project name="cutplace" default="bdist" basedir=".">
    <description>Buildfile for cutplace</description>

    <!-- Set global properties for this build. -->
    <property name="source" location="source" />
    <property name="build" location="build" />
    <property name="dist" location="dist" />
    <property name="external.dir" location="external" />
    <property name="site.dir" location="site" />
    <property name="test_all.py" location="${source}/cutplace/test_all.py" />

    <xmlcatalog id="catalogs">
        <dtd location="dtds/docbook-xml/docbookx.dtd" publicId="-//OASIS//DTD DocBook XML V4.5//EN" />
        <dtd location="dtds/html4/loose.dtd" publicId="-//W3C//DTD HTML 4.01 Transitional//EN" />
        <dtd location="dtds/xhtml/xhtml1-strict.dtd" publicId="-//W3C//DTD XHTML 1.0 Strict//EN" />
        <dtd location="dtds/xhtml/xhtml1-transitional.dtd" publicId="-//W3C//DTD XHTML 1.0 Transitional//EN" />
    </xmlcatalog>

    <target name="bdist" depends="version, user-guide" description="build binary distribution">
        <tstamp />
        <exec executable="python">
            <arg value="setup.py" />
            <arg value="bdist" />
        </exec>
    </target>

    <target name="test" depends="version" description="run test suite">
        <exec executable="python">
            <arg value="${test_all.py}" />
        </exec>
    </target>

    <target name="clean" description="clean up">
        <!-- Delete files and folders generated by target "bdist". -->
        <delete dir="${build}" />
        <delete dir="${dist}" />
        <delete dir="${source}" includes="**/*.pyc" />
    </target>

    <target description="update version information" name="version">
        <xslt in="version.xml" out="${source}/cutplace/version.py" style="${source}/xml/version-py.xsl" />
        <xslt in="version.xml" out="setup.py" style="${source}/xml/version-setup-py.xsl" />
    </target>

    <target name="site" depends="user-guide" description="build web site">
        <mkdir dir="${site.dir}/images" />
        <copy todir="${site.dir}/images">
            <fileset dir="${source}/site/images" includes="*.png" />
        </copy>
    </target>

    <target name="user-guide">
        <xslt classpath="${external.dir}/xalan.jar" in="${source}/site/user-guide.xml" out="${site.dir}/index.html" style="docbook-xsl/xhtml/docbook.xsl">
            <xmlcatalog refid="catalogs" />
        </xslt>
    </target>

    <target name="setup" description="setup project after checking it out">
        <untar compression="bzip2" src="${external.dir}/dtds.tar.bz2" dest="." />
        <untar compression="bzip2" src="${external.dir}/docbook-xsl.tar.bz2" dest="." />
    </target>
</project>
